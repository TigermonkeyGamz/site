<!-- ============================================
   RYNARA SKILL TREE â€” DEV TOOL + EMBED SAFE
   Full Fixed Version
============================================ -->
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Rynara Skill Tree</title>

<style>
html,body{
  margin:0;
  overflow:hidden;
  background:#0f1115;
  font-family:sans-serif;
}

#siteHeader{
  position:absolute;
  top:0;
  left:0;
  right:0;
  height:50px;
  background:#181a20;
  display:flex;
  align-items:center;
  padding-left:12px;
  color:white;
  z-index:10;
}

.embedded #siteHeader{
  display:none;
}

canvas{
  display:block;
}

/* DEV BUTTON */
#devBtn{
  position:absolute;
  top:10px;
  right:10px;
  width:28px;
  height:28px;
  background:#333;
  cursor:pointer;
  z-index:20;
}

/* DEV PANEL */
#devPanel{
  position:absolute;
  top:60px;
  right:10px;
  width:260px;
  background:#181a20;
  padding:10px;
  display:none;
  color:white;
  z-index:30;
}

input,textarea{
  width:100%;
  margin-bottom:6px;
  background:#0f1115;
  color:white;
  border:1px solid #444;
}
</style>
</head>

<body>

<div id="siteHeader">Rynara Skill Tree</div>
<canvas id="canvas"></canvas>

<div id="devBtn"></div>

<div id="devPanel">
  <h3>Add Skill</h3>
  <input id="id" placeholder="id">
  <input id="name" placeholder="name">
  <input id="parent" placeholder="parent">
  <input id="x" placeholder="x">
  <input id="y" placeholder="y">
  <button onclick="addSkill()">Add</button>
</div>

<script>

/* =========================
   EMBED DETECTION
========================= */
if(window.self!==window.top){
  document.body.classList.add("embedded");
}

/* =========================
   CANVAS SETUP
========================= */
const canvas=document.getElementById("canvas");
const ctx=canvas.getContext("2d");

function resize(){
  canvas.width=window.innerWidth;
  canvas.height=window.innerHeight;
}
resize();
window.addEventListener("resize",resize);

/* =========================
   CAMERA
========================= */
let camX=0;
let camY=0;
let scale=1;

let dragging=false;
let lastX=0;
let lastY=0;

canvas.addEventListener("mousedown",e=>{
 dragging=true;
 lastX=e.clientX;
 lastY=e.clientY;
});

window.addEventListener("mouseup",()=>dragging=false);

window.addEventListener("mousemove",e=>{
 if(!dragging)return;
 camX+=(e.clientX-lastX);
 camY+=(e.clientY-lastY);
 lastX=e.clientX;
 lastY=e.clientY;
});

/* =========================
   SKILLS
========================= */
const skillData=[
  {id:'warrior',name:'Way of the Warrior',cost:2,parent:null,x:-200,y:0,size:45,borderColor:'#FF0000'},
  {id:'flurry',name:'Flurry',cost:3,parent:'warrior',x:-350,y:0,size:60,borderColor:'#FF0000'},
  {id:'jump',name:'Jump',cost:2,parent:'flurry',x:-550,y:-70,size:60,borderColor:'#FF0000'},
  {id:'p-parry',name:'Power Parry',cost:1,parent:'flurry',x:-550,y:70,size:60,borderColor:'#FF0000'},
  {id:'+block',name:'Increased Shield',cost:1,parent:'p-parry',x:-700,y:100,size:45,borderColor:'#FF0000'}
];

const unlocked={};

/* =========================
   DEV MODE
========================= */
let devMode=false;

document.getElementById("devBtn").onclick=()=>{
 const pass=prompt("Dev Password");
 if(pass==="RynaraDev"){
   devMode=true;
   document.getElementById("devPanel").style.display="block";
 }
};

function addSkill(){
 skillData.push({
   id:id.value,
   name:name.value,
   parent:parent.value||null,
   x:Number(x.value),
   y:Number(y.value),
   size:50,
   borderColor:"#00FFFF"
 });
}

/* =========================
   HELPERS
========================= */
function getSkill(id){
 return skillData.find(s=>s.id===id);
}

function isAvailable(skill){
 if(!skill.parent)return true;
 return unlocked[skill.parent];
}

/* =========================
   CLICK UNLOCK
========================= */
canvas.addEventListener("click",e=>{
 const mx=(e.clientX-canvas.width/2-camX)/scale;
 const my=(e.clientY-canvas.height/2-camY)/scale;

 for(const s of skillData){
   const dx=mx-s.x;
   const dy=my-s.y;
   if(Math.sqrt(dx*dx+dy*dy)<s.size){
     if(isAvailable(s)) unlocked[s.id]=true;
   }
 }
});

/* =========================
   DRAW LOOP
========================= */
function draw(){

 ctx.clearRect(0,0,canvas.width,canvas.height);

 ctx.save();
 ctx.translate(canvas.width/2+camX,canvas.height/2+camY);
 ctx.scale(scale,scale);

 /* GRID */
 ctx.strokeStyle="#222";
 for(let x=-2000;x<2000;x+=100){
   ctx.beginPath();
   ctx.moveTo(x,-2000);
   ctx.lineTo(x,2000);
   ctx.stroke();
 }
 for(let y=-2000;y<2000;y+=100){
   ctx.beginPath();
   ctx.moveTo(-2000,y);
   ctx.lineTo(2000,y);
   ctx.stroke();
 }

 /* LINES FIRST */
 ctx.lineWidth=3;
 for(const s of skillData){
   if(!s.parent)continue;
   const p=getSkill(s.parent);
   ctx.strokeStyle=unlocked[s.id]?"#fff":"#555";
   ctx.beginPath();
   ctx.moveTo(p.x,p.y);
   ctx.lineTo(s.x,s.y);
   ctx.stroke();
 }

 /* NODES */
 for(const s of skillData){

   const available=isAvailable(s);

   ctx.beginPath();
   ctx.arc(s.x,s.y,s.size,0,Math.PI*2);

   ctx.fillStyle="#111";
   ctx.fill();

   ctx.lineWidth=4;
   ctx.strokeStyle=s.borderColor;
   ctx.stroke();

   if(!available){
     ctx.filter="grayscale(100%)";
   }else{
     ctx.filter="none";
   }

   ctx.fillStyle="white";
   ctx.font="14px sans-serif";
   ctx.textAlign="center";
   ctx.fillText(s.name,s.x,s.y+4);

   ctx.filter="none";
 }

 ctx.restore();
 requestAnimationFrame(draw);
}

draw();

</script>
</body>
</html>
